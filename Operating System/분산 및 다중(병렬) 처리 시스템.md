## 분산 및 다중(병렬) 처리 시스템

## 목차

1. [네트워크 컴퓨터 구성(프로세서의 결합도)](#네트워크-컴퓨터-구성프로세서의-결합도)
    - [강결합 시스템(병렬 처리 시스템)](#강결합-시스템병렬-처리-시스템)
    - [약결합 시스템(분산 처리 시스템)](#약결합-시스템분산-처리-시스템)
1. [분산처리 시스템](#분산처리-시스템)
    - [분산처리](#분산처리)
    - [분산 컴퓨팅 환경](#분산-컴퓨팅-환경)
    - [장점/단점](#장점단점)
1. [다중(병렬) 처리 시스템](#다중병렬-처리-시스템)
    - [프로세싱 기법에 따른 구분](#프로세싱-기법에-따른-구분)
    - [메모리 접근에 따른 구분](#메모리-접근에-따른-구분)
    - [Processor Affinity](#processor-affinity)
    - [Load balancing](#load-balancing)
    - [장점/단점](#장점단점-1)
1. [병렬처리와 분산처리 비교](#병렬처리와-분산처리-비교)
1. [예상 질문](#예상-질문)

---

## 네트워크 컴퓨터 구성(프로세서의 결합도)

- 컴퓨터로 처리해야 할 업무의 비중에 맞는 중소형 컴퓨터 여러 대를 구축하고 이들 컴퓨터를 네트워크로 연결해서 사용

### 강결합 시스템(병렬 처리 시스템)

> Tightly Coupled System

- 여러개의 프로세서가 하나의 메모리를 공유하는 `다중 프로세서(Multi-processor)` 구조
- 프로세서들이 메모리를 공유, `프로세서간 통신은 공유 메모리`를 통해 이루어짐
- 공유 메모리를 차지하려는 프로세서 간의 경쟁 최소화가 주요 고려 대상

### 약결합 시스템(분산 처리 시스템)

> Loosely Coupled System

- 두 개 이상의 독립된 컴퓨터 시스템이 `통신망을 통하여 연결`된 시스템(분산처리 시스템으로 알려짐)
- 각 시스템마다 `독자적인 운영체제, 메모리, 입출력장치`를 가지고 `독립적으로 운영`됨
- 프로세서 간의 통신은 `메시지 전달`이나 `원격 프로시저 호출`을 통해서 이루어짐
- 자원을 가지고 있는 사이트는 `서버(server)`가 되며, 반면 다른 사이트에서의 `클라이언트(client)`나 사용자는 그 자원을 사용

![DistributedSys2](https://user-images.githubusercontent.com/75410527/191037669-e2661ceb-205e-4ced-8466-6ad1d06f94b0.png)

## 분산처리 시스템

- 분산 시스템의 등장은 개인용 컴퓨터가 보급되면서 `인터넷이 활성화되기 시작`하고 분산 시스템의 개념이 나온다.
- 분산처리 시스템은 `대형 메인 프레임 컴퓨터`를 사용하는 것보다 `개인용 컴퓨터를 여러 개` 사용하여 하나로 묶어 대형 컴퓨터에 버금가는 시스템을 만드는 것

#### 특징

- LAN 같은 네트워크 인프라를 필요로 한다.
- 구조는 클라이언트 - 서버로 되어있다.

<img width="900" alt="스크린샷 2022-09-19 오후 10 37 13" src="https://user-images.githubusercontent.com/75410527/191030512-ca002929-577b-458f-b66e-5dc0d81413c5.png">

### 분산처리

- 하나의 컴퓨터 시스템이 처리 또는 제어하고 있던 기능을 `여러 개의 컴퓨터 시스템에 분산하여 처리`하는 것.
- 각 컴퓨터 시스템들은 자기만의 일을 처리할 수도 있으며 데이터 통신망을 이용하여 다른 컴퓨터 시스템과 통신하여 나누어 처리하기도 한다.
- 분산 처리(distributed processing)는 분산 컴퓨팅 환경에서 프로세싱 `자원, 메모리 자원 등을 공유`하여 `운영체제나 대규모 응용 프로그램(application program)을 처리`하는 것과 같이 포괄적인 컴퓨팅 처리 방식을 말한다. 

### 분산 컴퓨팅 환경

- 다수의 이기종 컴퓨터 간에 `애플리케이션을 분산 처리`하기 위한 환경
- 분산 컴퓨팅 환경은 `네트워크 전체`가 마치 `1대의 컴퓨터인 것처럼 동작`
  - 네트워크로 연결된 여려 대의 컴퓨터(노드)에 하나의 프로그램이 분산, 실행되면서 하나의 프로그램처럼 움직임
- 분산 컴퓨팅 환경 실현하기 위해서는 아래와 같은 기술이 필요하다. 
    - 복수의 컴퓨터상의 프로그램 간 통신을 위한 원격 절차 호출(`RPC`)
    - 분산 파일 시스템(distributed file system)
    - 디렉터리 서비스(directory service)
    - `인증 서비스(authentication service)`

### 장점/단점

|   | 장점                                                                                     | 단점                        |
|---|------------------------------------------------------------------------------------------|-----------------------------|
| 1 | 분산 처리를 통한 빠른 데이터 처리 속도(`연산 속도 향상`)                                   | `보안/통신 관리`가 복잡       |
|   | 동시에 수행 가능한 시스템 환경이 제공되므로 연산 속도 향상                               |                             |
| 2 | 한 사이트에 있는 자원을 다른 사이트가 이용할 수 있어서 자원 활용도 향상(`자원 공유`)          | `네트워크 리소스`가 많이 필요 |
| 3 | 데이터 손실에 대비한 장애 허용성 증가(`신뢰성이 높다`)                                            |                             |
|   | 하나의 시스템에 오류가 발생해도 시스템 전체의 성능에는 크게 영향을 주지 않는 신뢰성 제공 |                             |
| 4 | 다수의 사이트 간에 의견 교환 가능(`통신`) |                             |

---

## 다중(병렬) 처리 시스템

- 다중 프로세서(Multi Processors) 시스템으로 2개 이상의 CPU가 각자 맡은 역할을 수행하는 개념이다.
- 이러한 단일 프로세서 컴퓨터에 병렬기법 도입하여 운영체제를 단일 컴퓨터의 운영에서 벗어나 `여러 작업을 동시에` 처리 할 수 있게하는 병렬처리 시스템이 나타나게 되었다. 
- 병렬처리 시스템은 `컴퓨터를 병렬로 연결`하거나, `CPU등을 병렬로 연결`하여 `다수의 프로세서`들이 `다수의 프로그램들을 분담`하여 `동시에 처리`하는 방식 
- 하나의 운영체제 안에서 병렬로 연결된 자원, 메모리, CPU 또는 컴퓨터가 작업을 처리하는 방식을 총칭하는 의미로 병렬처리 시스템이라는 용어가 사용된다. 
  - 예시: 한글워드 프로세서를 사용하면서 윈도미디어 플레이어로 음악을 듣고 동시에 메신져를 켜놓을 수 있는 것

### 프로세싱 기법에 따른 구분

#### Asymmetric multiprocessing

- 하나의 master 프로세스가 다른 프로세스들을 관리감독하는 형태
- master 프로세서가 `Load balancing`을 다 결정한다.

#### Symmetric multiprocessing (SMP)

- 각각의 프로세스가 동등한 권한으로 프로세싱하는 형태
- **각각의 프로세서는 각자 스케줄링을 진행한다.**
- 프로세스들은 하나의 ready queue에 저장되어있거나, 각각의 프로세서의 private queue에 저장되어있다.
- 대부분의 멀티프로세스가 이러한 형태.

![스크린샷 2022-09-20 오전 1 43 16](https://user-images.githubusercontent.com/75410527/191070474-e347b64c-7946-4f62-8544-538c7cc98d61.png)


### 메모리 접근에 따른 구분

#### Uniform Memory Access

- 하나의 공유된 메모리에 여러개의 프로세서가 할당된 형태.
- 하나의 메모리를 공유하여 사용한다.
- 프로세서가 어느 메모리를 참조하든 접근속도가 동일하다

#### Non-Uniform Memory Access (NUMA)

- 각각의 프로세서에 메모리가 따로 담겨있는 형태.
- 만약 다른 프로세서에서 자신의 메모리를 참조할 때 속도가 느리므로, 스케줄링 시 이를 고려해주어야 한다.
- 이 때 필요한 개념이 Affinity 이다.

### Processor Affinity

> 프로세스 스케줄링 시에, 특정 프로세서에 지정을 해주는것. 프로세스는 특정 프로세서에서만 실행되게 된다.  
> 이건 이전에 이 프로세스를 이 CPU에서 실행한 적이 있는가를 의미하게 되는데 이 경우 해당 코드의 일부가 캐시에 담겨져 있을 가능성이 높으니 이전에 실행했던 CPU를 선택하게 된다.

- 프로세스는 현재 돌고있는 프로세서의 메모리에 address space등의 메모리를 차지할 것이다. (NUMA의 경우)
- 이 때, 다른 프로세서의 메모리에 있는 데이터를 참조한다면, 시간이 오래걸릴것이다.
- 따라서 자신이 현재 돌고있는 프로세서의 메모리와, 자신이 접근하려는 데이터가 있는 메모리를 같도록 만들어줄 때 Processor Affinity를 활용하기도 한다.
  1. `soft Affinity`: 같은 프로세서에서 돌 수 있도록 priority를 높여주는 등 노력은 하지만, 보장은 안되는 경우.
  2. `hard Affinity`: 특정 프로세서에만 돌도록 완전히 보장시켜주는 경우.

### Load balancing

> 특정 프로세서(CPU)가 너무 많은 프로세스를 돌린다 싶으면, 스케줄러가 적절히 분배해주는 행위.  
> CPU마다 utilization을 체크해서 바쁜 쪽의 일을 덜 바쁜 쪽으로 가지고 와 수행하게 된다.

- `processor Affinity` 등에 의해 특정 프로세서가 너무 많은 프로세스를 돌리는 경우에, 스케줄러가 적절히 분배해주는 것을 load balancing이라 한다. 
- 앞서 말했듯이 `Asymmetric multiprocessor`에서는 `master` 프로세서가 load balancing 해준다.
  1. `Push migration`: 바쁜 프로세서가 자기의 일을 던지는 것.
  2. `Pull migration`: 노는 프로세서가 다른 일 가져오는 것.

### 장점/단점

|   | 장점                                                                    | 단점                                                                    |
|---|-------------------------------------------------------------------------|-------------------------------------------------------------------------|
| 1 | 경제적이다                                                              | 프로세서 수가 많아질수록 프로세서 간 데이터 교환에 따른 오버헤드도 증가 |
| 2 | 처리량이 높다(High Throughput)                                          |                                                                         |
| 3 | 신뢰성이 높다. 하나의 CPU가 고장나더라도 다른 CPU가 일을 수행할 수 있다 |                                                                         |

---

## 병렬처리와 분산처리 비교

- 병렬처리 시스템은 프로세서를 늘려서 `여러 일을 동시에`, 더 빨리 처리 할 수 있게 해주는 시스템
  - 병렬처리는 “동시에 여러 일”을 처리하는 것
- 분산처리 시스템은 하나의 컴퓨터 시스템이 처리 또는 제어하고 있던 기능을 `여러 개의 컴퓨터 시스템에 분산하여 처리`하는 것.
  - 분산처리는 “하나의 일을 동시에 여럿이서” 처리하는 것

---

## 예상 질문

### 병렬처리

- 프로세스 컨텍스트 스위칭과 쓰레드 컨텍스트 스위칭의 차이는?
- IPC에서 공유 메모리와 메시지 패싱 방식의 차이는?
- 멀티 프로세서의 경우 스케줄링에 영향을 미치는 요소는?

---

### 출처

- [[OS] 병렬처리 시스템과 분산처리 시스템](https://croute.me/1)
- [컴퓨터 시스템 정리 (분산 시스템, 병렬 시스템, 클러스터 시스템, Real-Time 시스템, Handled 시스템)](https://enlqn1010.tistory.com/31)
- [분산 처리, 分散處理, distributed processing](http://terms.tta.or.kr/dictionary/dictionaryView.do?subject=%EB%B6%84%EC%82%B0+%EC%B2%98%EB%A6%AC)
- [분산 컴퓨팅 환경, 分散-環境, Distributed Computing Environment, DCE](http://terms.tta.or.kr/dictionary/dictionaryView.do?subject=%EB%B6%84%EC%82%B0+%EC%BB%B4%ED%93%A8%ED%8C%85+%ED%99%98%EA%B2%BD)
- [분산 데이터 처리, 分散-處理, Distributed Data Processing, DDP](http://terms.tta.or.kr/dictionary/dictionaryView.do?word_seq=041645-3)
- [운영체제 - 분산 및 병렬 처리 시스템](https://leleluv1122.github.io/technical_interview/tech_interview_10/)
- [분산 및 다중(병렬) 처리 시스템](https://github.com/workhardslave/cs-study/blob/main/OS/%EB%B6%84%EC%82%B0%20%EB%B0%8F%20%EB%8B%A4%EC%A4%91(%EB%B3%91%EB%A0%AC)%20%EC%B2%98%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C.md)
- [16. 프로세스 스케줄링_5 (멀티프로세서 스케줄링)](https://ddongwon.tistory.com/39)


